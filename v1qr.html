<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Generator</title>
    <!-- Use Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use a simple CDN for the QR code generation library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <style>
        /* Custom styles for a clean, modern look */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
        }
        /* Styles for the button when disabled */
        #generate-btn:disabled {
            background-color: #d1d5db;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div class="bg-white p-8 md:p-12 rounded-2xl shadow-2xl w-full max-w-xl text-center">
        <h1 class="text-4xl font-extrabold text-gray-900 mb-4">QR Code Generator</h1>
        <p class="text-gray-600 mb-8">Enter a URL below to generate a high-resolution QR code.</p>

        <!-- Changed type="url" to type="text" to remove browser validation -->
        <input type="text" id="url-input" placeholder="e.g., https://www.example.com" required
               class="w-full px-5 py-3 mb-6 text-lg text-gray-800 bg-gray-200 rounded-xl focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50 transition duration-300 ease-in-out">

        <button id="generate-btn"
                class="w-full px-8 py-4 mb-8 text-xl font-bold text-white bg-blue-600 rounded-xl shadow-lg hover:bg-blue-700 transition duration-300 ease-in-out">
            Generate QR Code
        </button>

        <!-- Message box for user feedback -->
        <div id="message-box" class="hidden text-sm text-red-600 mb-4"></div>

        <!-- The container for the final QR code image and download button -->
        <div id="qr-result" class="hidden text-center">
            <!-- The final image element to display the 1000x1000px QR code with border -->
            <img id="qr-code-image" alt="Generated QR Code" class="w-full h-auto max-w-full mx-auto" style="display: none;">
            
            <a id="download-btn" href="#" download="qrcode.png"
                class="mt-6 px-8 py-3 text-lg font-bold text-white bg-green-600 rounded-xl shadow-lg hover:bg-green-700 transition duration-300 ease-in-out">
                Download QR Code
            </a>
        </div>
        
        <!-- A hidden container for the intermediate canvas used for generation -->
        <div id="qr-code-container" class="hidden"></div>
    </div>

    <script>
        const urlInput = document.getElementById('url-input');
        const generateBtn = document.getElementById('generate-btn');
        const messageBox = document.getElementById('message-box');
        const qrCodeContainer = document.getElementById('qr-code-container');
        const qrCodeImage = document.getElementById('qr-code-image');
        const qrResult = document.getElementById('qr-result');
        const downloadBtn = document.getElementById('download-btn');

        // Function to show a temporary message to the user
        function showMessage(message, type = 'error') {
            messageBox.textContent = message;
            messageBox.style.color = type === 'error' ? '#ef4444' : '#10b981';
            messageBox.classList.remove('hidden');
        }

        // Handle the button click event
        generateBtn.addEventListener('click', () => {
            let url = urlInput.value.trim();

            // Clear previous output and messages
            qrCodeImage.style.display = 'none';
            qrResult.classList.add('hidden');
            qrCodeContainer.innerHTML = '';
            messageBox.classList.add('hidden');
            
            if (url) {
                // Check if the URL already has a protocol. If not, add https:// to ensure it's
                // recognized as a link by most QR code scanners.
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    url = 'https://' + url;
                }

                // Temporarily disable the button to prevent multiple clicks
                generateBtn.disabled = true;
                generateBtn.textContent = 'Generating...';

                // Use the QRCode.js library to generate the QR code as a canvas
                // It's important to set the width and height here to get the high-res output
                const qrcode = new QRCode(qrCodeContainer, {
                    text: url,
                    width: 1000,
                    height: 1000,
                    colorDark : "#000000",
                    colorLight : "#ffffff",
                    correctLevel : QRCode.CorrectLevel.H // High error correction level
                });

                // Wait for a small moment to ensure the canvas is fully rendered
                setTimeout(() => {
                    // Get the canvas element created by the library
                    const originalCanvas = qrCodeContainer.querySelector('canvas');
                    if (originalCanvas) {
                        // Create a new canvas to draw the QR code with a border
                        const newCanvasSize = 1200; // 1000px QR code + 10% (100px) border on each side
                        const borderedCanvas = document.createElement('canvas');
                        borderedCanvas.width = newCanvasSize;
                        borderedCanvas.height = newCanvasSize;
                        const ctx = borderedCanvas.getContext('2d');

                        // Fill the entire new canvas with white color
                        ctx.fillStyle = '#ffffff';
                        ctx.fillRect(0, 0, newCanvasSize, newCanvasSize);

                        // Draw the original QR code canvas onto the new canvas with a 10% border
                        const borderSize = 100;
                        ctx.drawImage(originalCanvas, borderSize, borderSize);

                        // Convert the new canvas content to a data URL (PNG)
                        const dataURL = borderedCanvas.toDataURL("image/png");
                        
                        // Set the src of the image and the download button's href
                        qrCodeImage.src = dataURL;
                        qrCodeImage.style.display = 'block';
                        downloadBtn.href = dataURL;
                        
                        // Show the result container
                        qrResult.classList.remove('hidden');

                        // Restore button state
                        generateBtn.disabled = false;
                        generateBtn.textContent = 'Generate QR Code';
                        
                        showMessage('QR Code generated successfully!', 'success');
                    } else {
                        showMessage('An error occurred during QR code generation. Please try again.', 'error');
                        generateBtn.disabled = false;
                        generateBtn.textContent = 'Generate QR Code';
                    }
                }, 500); // A small delay to ensure the canvas is ready
            } else {
                showMessage('Please enter a valid URL.', 'error');
            }
        });
    </script>

</body>
</html>
